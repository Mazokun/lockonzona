local RakLua = require 'RakLua'

function main()
	while not isSampAvailable() do wait(0) end

	sampRegisterChatCommand('exploit', exploit)
	sampRegisterChatCommand('exploit2', exploit2)
	sampRegisterChatCommand('envcreate', envcreate)

end

function exploit()
	RakLua.registerHandler(RakLuaEvents.INCOMING_RPC,
		function(id, bs)
			active = 1
			if id == 16 and active == 1 then
				local soundid = bs:readUInt32()
				path = getWorkingDirectory() .. '\\ParserEx\\parsex.log'
				local f = io.open(path, 'a+')
				if f then
					f:write(string.format('Listened by Exploit Finder Algorythm: \n'))
					f:write(string.format('Listened ID sound(UInt32): '.. soundid ..'\n'))
					f:write(string.format('-----------------------------------------\n'))
					f:close()
				end
				if soundid == 17803 then
					sampSendClickTextdraw(12)
				elseif soundid == 36401 then
					sampSendClickTextdraw(11)
				end
			end
		end)
end

function envcreate()
	sampSendClickTextdraw(12)
end

function exploit2()
	active = 0
end

function onScriptTerminate(scr)
    if scr == script.this then
        RakLua.destroyHandlers()
    end
end